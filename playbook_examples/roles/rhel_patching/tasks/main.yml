---

- name: check to see if server has package updates
  ansible.builtin.shell: dnf list --updates | awk 'f;/Available Upgrades/{f=1}' | awk '{ print $1}'
  register: updates

- name: display count
  debug:
    msg: "Found {{ updates.stdout_lines | length }} packages to updated"

- name: Update server if packages are available
  block:
   - name: Run a dnf update
     ansible.builtin.dnf:
       name: "*"
       state: latest
